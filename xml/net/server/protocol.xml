<protocol>
    <enum name="InitResult" type="byte">
        <comment>Result code sent with INIT_INIT packet</comment>
        <value name="OutOfDate">1</value>
        <value name="Ok">2</value>
        <value name="Banned">
          <comment>The official client won't display a message until the connection from the server is closed</comment>
          3
        </value>
        <value name="MapMutation">4</value>
        <value name="FileEmf">5</value>
        <value name="FileEif">6</value>
        <value name="FileEnf">7</value>
        <value name="FileEsf">8</value>
        <value name="PlayersList">20</value>
        <value name="WarpMap">10</value>
        <value name="PlayersListFriends">22</value>
        <value name="FileEcf">12</value>
    </enum>

    <enum name="InitBanType" type="byte">
        <comment>
            Ban type sent with INIT_INIT packet.
            The official client treats a value &gt;= 2 as Permanent. Otherwise, it's Temporary.
        </comment>
        <value name="Temporary">1</value>
        <value name="Permanent">2</value>
    </enum>

    <enum name="InnUnsubscriptResult" type="char">
      <value name="NotCitizen">0</value>
      <value name="Unsubscribed">1</value>
    </enum>

    <enum name="ChatResult" type="short">
      <comment>Result code sent with Chat_Result packets</comment>
      <value name="NotFound">1</value>
    </enum>

    <enum name="LoginResult" type="short">
        <comment>
            Result code sent with LOGIN_REPLY packet.
            Indicates the result of a login attempt.
        </comment>
        <value name="Ok">1</value>
        <value name="WrongUser">2</value>
        <value name="WrongUserPassword">3</value>
        <value name="Banned">
          <comment>The official client won't display a message until the connection from the server is closed</comment>
          4
        </value>
        <value name="LoggedIn">5</value>
        <value name="Busy">
          <comment>The official client won't display a message until the connection from the server is closed</comment>
          6
        </value>
    </enum>

    <enum name="PlayerKilledState" type="char">
        <comment>Flag to indicate that a player has been killed</comment>
        <value name="Alive">1</value>
        <value name="Killed">2</value>
    </enum>

    <enum name="PlayResult" type="short">
      <value name="Ok">1</value>
    </enum>

    <enum name="ExperienceDisplayMode" type="char">
      <value name="Normal">0</value>
      <value name="ShowReduced">1</value>
      <value name="Reserved2">2</value>
    </enum>

    <enum name="CharacterIcon" type="char">
        <comment>Icon displayed in paperdolls, books, and the online list</comment>
        <value name="Player">1</value>
        <value name="Gm">4</value>
        <value name="Hgm">5</value>
        <value name="Party">6</value>
        <value name="GmParty">9</value>
        <value name="HgmParty">10</value>
    </enum>

    <enum name="WarpEffect" type="char">
        <comment>An effect that accompanies a player warp</comment>
        <value name="None">
            <comment>Does nothing</comment>
            0
        </value>
        <value name="Scroll">
            <comment>Plays the scroll sound effect</comment>
            1
        </value>
        <value name="Admin">
            <comment>Plays the admin warp sound effect and animation</comment>
            2
        </value>
    </enum>

    <enum name="BannerType" type="char">
      <comment>Decoration type for banner messages</comment>
      <value name="Grey">0</value>
      <value name="BlinkingYellow">1</value>
      <value name="BlinkingBlue">2</value>
      <value name="BlinkingGreen">3</value>
      <value name="BlinkingRed">4</value>
      <value name="BlinkingXs">5</value>
      <value name="Confetti">6</value>
      <value name="Heart">7</value>
      <value name="Sword">8</value>
      <value name="Skull">9</value>
      <value name="Trophy">10</value>
      <value name="RedFlag">11</value>
      <value name="BlueFlag">12</value>
    </enum>

    <enum name="WarpType" type="char">
      <value name="Local">1</value>
      <value name="Switch">2</value>
    </enum>

    <enum name="WarpAnimation" type="char">
      <value name="None">0</value>
      <value name="Scroll">1</value>
      <value name="Admin">2</value>
    </enum>

    <enum name="MapTimeChangeType" type="char">
        <comment>Defines the change type for warp time.</comment>
        <value name="DayMode">0</value>
        <value name="LightAdjustment">1</value>
    </enum>

    <struct name="GlobalBackfillMessage">
        <comment>A backfilled global chat message</comment>
        <chunked>
            <field name="name" type="string"/>
            <break/>
            <field name="message" type="string"/>
        </chunked>
    </struct>

    <struct name="MapFile">
        <comment>A map file (EMF)</comment>
        <field name="content" type="blob"/>
    </struct>

    <struct name="PubFile">
        <comment>A pub file (EIF, ENF, ECF, ESF)</comment>
        <field name="file_id" type="char"/>
        <field name="content" type="blob"/>
    </struct>

    <struct name="PlayersList">
        <comment>Information about online players</comment>
        <chunked>
            <length name="players_count" type="short"/>
            <break/>
            <array name="players" type="OnlinePlayer" length="players_count" delimited="true"/>
        </chunked>
    </struct>

    <struct name="PlayersListFriends">
        <comment>
            Information about online players.
            Sent in reply to friends list requests.
        </comment>
        <chunked>
            <length name="players_count" type="short"/>
            <break/>
            <array name="players" type="string" length="players_count" delimited="true"/>
        </chunked>
    </struct>

    <struct name="OnlinePlayer">
        <comment>A player in the online list</comment>
        <chunked>
            <field name="name" type="string"/>
            <break/>
            <field name="title" type="string"/>
            <break/>
            <field name="level" type="char"/>
            <field name="icon" type="CharacterIcon"/>
            <field name="class_id" type="char"/>
            <field name="guild_tag" type="string"/>
        </chunked>
    </struct>

    <struct name="CharacterSelectionListEntry">
        <comment>Character selection screen character</comment>
        <chunked>
            <field name="name" type="string"/>
            <break/>
            <field name="creation_date" type="string"/>
            <break/>
            <field name="last_login_date" type="string"/>
            <break/>
            <field name="id" type="int"/>
            <field name="level" type="short"/>
            <field name="gender" type="Gender"/>
            <field name="hair_style" type="char"/>
            <field name="hair_color" type="char"/>
            <field name="skin" type="char"/>
            <field name="admin" type="AdminLevel"/>
            <field name="equipment" type="EquipmentCharacterSelect"/>
        </chunked>
    </struct>

    <struct name="EquipmentCharacterSelect">
        <comment>
            Player equipment data.
            Sent with a character in the character selection list.
            Note that these values are graphic IDs.
        </comment>
        <field name="boots" type="short"/>
        <field name="armor" type="short"/>
        <field name="hat" type="short"/>
        <field name="weapon" type="short"/>
        <field name="shield" type="short"/>
        <field name="buddy_shoulder" type="short"/>
        <field name="buddy_ground" type="short"/>
        <field name="torch" type="short"/>
    </struct>

    <struct name="CharacterStatsPlay">
      <field name="hp" type="three"/>
      <field name="max_hp" type="three"/>
      <field name="tp" type="three"/>
      <field name="max_tp" type="three"/>
      <field name="sp" type="short"/>
      <field name="max_sp" type="short"/>
      <field name="stat_points" type="short"/>
      <field name="skill_points" type="short"/>
      <field name="karma" type="short"/>
      <field name="secondary" type="CharacterSecondaryStats"/>
      <field name="base" type="CharacterBaseStats"/>
    </struct>

    <struct name="CharacterStatsEquipmentChange">
      <field name="max_hp" type="three"/>
      <field name="max_tp" type="three"/>
      <field name="base" type="CharacterBaseStats"/>
      <field name="secondary" type="CharacterSecondaryStats"/>
    </struct>

    <struct name="CharacterBaseStats">
      <field name="power" type="short"/>
      <field name="defense" type="short"/>
      <field name="accuracy" type="short"/>
      <field name="dexterity" type="short"/>
      <field name="vitality" type="short"/>
      <field name="aura" type="short"/>
    </struct>

    <struct name="CharacterSecondaryStats">
      <field name="damage_low" type="three"/>
      <field name="damage_high" type="three"/>
      <field name="hit_rate" type="three"/>
      <field name="evade" type="three"/>
      <field name="armor" type="three"/>
      <field name="crit_chance" type="char"/>
    </struct>

    <struct name="EquipmentItem">
      <field name="id" type="short"/>
      <field name="power" type="char"/>
      <field name="accuracy" type="char"/>
      <field name="dexterity" type="char"/>
      <field name="defense" type="char"/>
      <field name="vitality" type="char"/>
      <field name="aura" type="char"/>
    </struct>

    <struct name="EquipmentPlay">
        <comment>
            Player equipment data.
            Sent upon selecting a character and entering the game
            Note that these values are item IDs.
        </comment>
        <field name="weapon" type="EquipmentItem"/>
        <field name="shield" type="EquipmentItem"/>
        <field name="armor" type="EquipmentItem"/>
        <field name="hat" type="EquipmentItem"/>
        <field name="boots" type="EquipmentItem"/>
        <field name="gloves" type="EquipmentItem"/>
        <field name="accessory" type="EquipmentItem"/>
        <field name="belt" type="EquipmentItem"/>
        <field name="necklace" type="EquipmentItem"/>
        <array name="ring" type="EquipmentItem" length="2"/>
        <array name="armlet" type="EquipmentItem" length="2"/>
        <array name="bracer" type="EquipmentItem" length="2"/>
        <field name="costume" type="EquipmentItem"/>
        <field name="hat_cosmetic" type="EquipmentItem"/>
        <field name="wings" type="EquipmentItem"/>
        <field name="buddy_shoulder" type="EquipmentItem"/>
        <field name="buddy_ground" type="EquipmentItem"/>
        <field name="torch" type="EquipmentItem"/>
    </struct>


    <struct name="EquipmentMapInfo">
        <comment>
            Player equipment data.
            Sent with map information about a nearby character.
            Note that these values are graphic IDs.
        </comment>
        <field name="boots" type="short"/>
        <field name="armor" type="short"/>
        <field name="hat" type="short"/>
        <field name="weapon" type="short"/>
        <field name="shield" type="short"/>
        <field name="buddy_shoulder" type="short"/>
        <field name="buddy_ground" type="short"/>
        <field name="torch" type="short"/>
    </struct>

    <struct name="CharacterMapInfo">
        <comment>
            Information about a nearby character.
        </comment>
        <chunked>
            <field name="name" type="string"/>
            <break/>
            <field name="player_id" type="short"/>
            <field name="coords" type="Coords"/>
            <field name="npc_id" type="short">
              <comment>If set character will appear as this NPC</comment>
            </field>
            <field name="unk1" type="short"/>
            <field name="unk2" type="short"/>
            <field name="direction_sitting_hiding" type="char"/>
            <field name="unk3" type="char"/>
            <field name="level" type="short"/>
            <field name="unk4" type="char"/>
            <field name="gender_skin" type="char"/>
            <field name="hair_style" type="char"/>
            <field name="hair_color" type="char"/>
            <field name="hp" type="three"/>
            <field name="max_hp" type="three"/>
            <field name="tp" type="three"/>
            <field name="max_tp" type="three"/>
            <field name="guild_tag" type="string" length="3"/>
            <field name="equipment" type="EquipmentMapInfo"/>
        </chunked>
    </struct>

    <struct name="NpcMapInfo">
        <comment>Information about a nearby NPC</comment>
        <field name="index" type="short"/>
        <field name="id" type="short"/>
        <field name="coords" type="Coords"/>
        <field name="direction" type="Direction"/>
    </struct>

    <struct name="ItemMapInfo">
        <comment>Information about a nearby item on the ground</comment>
        <field name="index" type="short"/>
        <field name="item" type="ThreeItem"/>
        <field name="coords" type="Coords"/>
    </struct>

    <struct name="QuestItemMapInfo">
      <comment>Information about a nearby quest item on the ground</comment>
      <field name="item_id" type="short"/>
      <field name="coords" type="Coords"/>
    </struct>

    <struct name="GatherMapInfo">
      <comment>Information about nearby gatherable items</comment>
      <field name="index" type="char"/>
      <field name="amount" type="char"/>
    </struct>

    <struct name="NearbyInfo">
        <comment>Information about nearby entities</comment>
        <length name="characters_count" type="short"/>
        <chunked>
            <break/>
            <array name="characters" type="CharacterMapInfo" length="characters_count" delimited="true"/>
            <array name="npcs" type="NpcMapInfo"/>
            <break/>
            <array name="items" type="ItemMapInfo"/>
            <break/>
            <array name="gathers" type="GatherMapInfo"/>
            <break/>
            <array name="quest_items" type="QuestItemMapInfo"/>
        </chunked>
    </struct>

    <struct name="NpcUpdatePosition">
        <comment>An NPC walking</comment>
        <field name="npc_index" type="short"/>
        <field name="coords" type="Coords"/>
        <field name="direction" type="Direction"/>
    </struct>

    <struct name="NpcUpdateAttack">
        <comment>An NPC attacking</comment>
        <field name="npc_index" type="short"/>
        <field name="direction" type="Direction"/>
        <field name="player_id" type="short"/>
        <field name="hp_percentage" type="char"/>
        <field name="killed" type="PlayerKilledState"/>
        <field name="damage" type="int"/>
        <field name="unk" type="char"/>
    </struct>

    <struct name="NpcUpdateChat">
        <comment>An NPC talking</comment>
        <field name="npc_index" type="short"/>
        <length name="message_length" type="char"/>
        <field name="message" type="string" length="message_length"/>
    </struct>

    <packet family="Boss" action="Syn1">
      <comment>Boss bar sync</comment>
      <field name="npc_index" type="short"/>
      <field name="npc_id" type="short"/>
      <field name="hp" type="three"/>
      <field name="hp_percentage" type="char"/>
      <field name="killed" type="bool"/>
    </packet>

    <packet family="Cast" action="Self">
      <comment>Nearby player casting spell on their self</comment>
      <field name="player_id" type="short"/>
      <field name="spell_id" type="short"/>
      <field name="spell_heal_hp" type="three"/>
      <field name="hp_percentage" type="char"/>
      <field name="hp" type="three" optional="true">
          <comment>The official client reads this if the packet is larger than 12 bytes</comment>
      </field>
      <field name="tp" type="three" optional="true">
          <comment>The official client reads this if the packet is larger than 12 bytes</comment>
      </field>
    </packet>

    <packet family="Inn" action="Open">
      <comment>Response from talking to an inn-keeper NPC</comment>
      <chunked>
          <field name="behavior_id" type="three"/>
          <field name="current_home_id" type="char"/>
          <field name="session_id" type="short"/>
          <break/>
          <array name="questions" type="string" length="3" delimited="true" trailing-delimiter="false"/>
      </chunked>
    </packet>

    <packet family="Inn" action="Request">
      <comment>Reply to requesting to sleep at an inn</comment>
      <field name="cost" type="int"/>
    </packet>

    <packet family="Inn" action="Confirm">
      <comment>Sleeping at an inn</comment>
      <field name="total_eons" type="int"/>
    </packet>

    <packet family="Inn" action="Result">
      <comment>Reply to subscribing to a town</comment>
      <field name="questions_wrong" type="char"/>
    </packet>

    <packet family="Inn" action="Delete">
      <comment>Reply to giving up citizenship of a town</comment>
      <field name="result_code" type="InnUnsubscriptResult"/>
    </packet>

    <packet family="Item" action="Update">
      <comment>Items appearing in nearby view</comment>
      <chunked>
        <array name="items" type="ItemMapInfo" delimited="true"/>
      </chunked>
    </packet>

    <packet family="Item" action="Add">
      <comment>Item dropped nearby</comment>
      <field name="item_id" type="short"/>
      <field name="power" type="char"/>
      <field name="accuracy" type="char"/>
      <field name="dexterity" type="char"/>
      <field name="defense" type="char"/>
      <field name="vitality" type="char"/>
      <field name="aura" type="char"/>
      <field name="item_index" type="short"/>
      <field name="amount" type="three"/>
      <field name="coords" type="Coords"/>
      <field name="player_id" type="short"/>
    </packet>

    <packet family="Item" action="Drop">
      <comment>Reply to dropping an item</comment>
      <field name="item" type="ThreeItem"/>
      <field name="remaining" type="int"/>
      <field name="item_index" type="short"/>
      <field name="coords" type="Coords"/>
      <field name="weight" type="Weight"/>
    </packet>

    <packet family="Item" action="Delete">
        <comment>Item disappeared from the ground</comment>
        <field name="item_index" type="short"/>
    </packet>

    <packet family="Item" action="Junk">
      <comment>Reply to junking an item</comment>
      <field name="item" type="ThreeItem"/>
      <field name="remaining" type="int"/>
      <field name="item_index" type="short"/>
      <field name="weight" type="Weight"/>
    </packet>


    <packet family="Item" action="Pickup">
      <comment>Reply to picking up an item</comment>
      <field name="item_id" type="short"/>
      <field name="power" type="char"/>
      <field name="accuracy" type="char"/>
      <field name="dexterity" type="char"/>
      <field name="defense" type="char"/>
      <field name="vitality" type="char"/>
      <field name="aura" type="char"/>
      <field name="item_index" type="short"/>
      <field name="amount" type="three"/>
      <field name="weight" type="Weight"/>
    </packet>

    <packet family="Item" action="Result">
      <field name="item_type" type="ItemType"/>
      <field name="used_item" type="Item"/>
      <field name="current_weight" type="short"/>
      <switch field="item_type">
        <case value="Heal">
            <field name="hp_gain" type="short"/>
            <field name="tp_gain" type="short"/>
            <field name="sp_gain" type="short"/>
            <field name="hp" type="three"/>
            <field name="tp" type="three"/>
            <field name="sp" type="short"/>
        </case>
        <case value="TitleCertificate">
          <!-- 1 == title, 2 == announcement "Your message has been delivered!" in ida -->
          <field name="unk" type="char"/>
        </case>
        <case value="Transformation">
          <field name="skin" type="char"/>
        </case>
        <case value="SkillBook">
          <field name="skill_id" type="short"/>
        </case>
        <case value="CureCurse">
          <field name="stats" type="CharacterStatsEquipmentChange"/>
        </case>
        <case value="HairDye">
          <field name="hair_color" type="char"/>
        </case>
        <case value="EffectPotion">
          <field name="effect_id" type="short"/>
        </case>
        <case value="ExpReward">
          <field name="total_experience" type="five"/>
        </case>
          <!-- TODO: Test a scroll.. the client is doing something here
            <case value="Teleport"></case>
          -->
      </switch>
    </packet>

    <packet family="Init" action="Init">
        <comment>
            Result to connection initialization and requests for unencrypted data.
            This packet is unencrypted.
        </comment>
        <field name="reply_code" type="InitResult"/>
        <switch field="reply_code">
            <case value="OutOfDate">
                <field name="version" type="Version"/>
            </case>
            <case value="Ok">
                <field name="seq1" type="byte"/>
                <field name="seq2" type="byte"/>
                <field name="server_encryption_value" type="short"/>
                <field name="client_encryption_value" type="short"/>
                <field name="player_id" type="short"/>
                <field name="challenge_response" type="three"/>
                <field name="extra_param_increment" type="byte" />
            </case>
            <case value="Banned">
                <field name="ban_type" type="InitBanType"/>
                <switch field="ban_type">
                    <case value="0">
                        <comment>
                            The official client treats any value below 2 as a temporary ban.
                            The official server sends 1, but some game server implementations
                            erroneously send 0.
                        </comment>
                        <field name="minutes_remaining" type="byte"/>
                    </case>
                    <case value="Temporary">
                        <field name="minutes_remaining" type="byte"/>
                    </case>
                </switch>
            </case>
            <case value="WarpMap">
                <field name="map_file" type="MapFile"/>
            </case>
            <case value="FileEmf">
                <field name="map_file" type="MapFile"/>
            </case>
            <case value="FileEif">
                <field name="pub_file" type="PubFile"/>
            </case>
            <case value="FileEnf">
                <field name="pub_file" type="PubFile"/>
            </case>
            <case value="FileEsf">
                <field name="pub_file" type="PubFile"/>
            </case>
            <case value="FileEcf">
                <field name="pub_file" type="PubFile"/>
            </case>
            <case value="MapMutation">
                <field name="map_file" type="MapFile"/>
            </case>
            <case value="PlayersList">
                <chunked>
                    <field name="players_list" type="PlayersList"/>
                </chunked>
            </case>
            <case value="PlayersListFriends">
                <chunked>
                    <field name="players_list" type="PlayersListFriends"/>
                </chunked>
            </case>
        </switch>
    </packet>

    <packet family="Captcha" action="Open">
      <comment>Captcha opened</comment>
      <array name="captcha_id" type="short" length="2"/>
      <field name="encrypted_data" type="blob" />
    </packet>

    <packet family="Captcha" action="Update">
      <comment>Captcha updated</comment>
      <field name="captcha_id" type="short"/>
      <field name="encrpted_captcha" type="string"/>
    </packet>

    <packet family="Captcha" action="Close">
      <comment>Captcha closed</comment>
      <field name="total_experience" type="five"/>
    </packet>

    <enum name="DialogMessageId" type="char">
      <value name="Welcome">1</value>
      <value name="Warning">2</value>
    </enum>

    <packet family="Dialog" action="Get">
      <comment>Shows a message box</comment>
      <field name="message_id" type="DialogMessageId"/>
    </packet>

    <packet family="Dialog" action="Self">
      <comment>#boost command</comment>
      <field name="max_boost_level" type="char"/>
    </packet>

    <enum name="AdminMessageType" type="char">
        <comment>Type of message sent to admins via the Help menu</comment>
        <value name="Message">1</value>
        <value name="Report">2</value>
    </enum>

    <packet family="Dialog" action="Confirm">
      <comment>Incoming admin message</comment>
        <chunked>
            <field name="message_type" type="AdminMessageType"/>
            <break/>
            <switch field="message_type">
                <case value="Message">
                    <field name="player_name" type="string"/>
                    <break/>
                    <field name="message" type="string"/>
                </case>
                <case value="Report">
                    <field name="player_name" type="string"/>
                    <break/>
                    <field name="message" type="string"/>
                    <break/>
                    <field name="reportee_name" type="string"/>
                </case>
            </switch>
        </chunked>
    </packet>

    <packet family="Game" action="Block">
      <comment>Show waiting for players banner</comment>
      <field name="unk" type="char"/>
      <field name="num_players" type="char"/>
    </packet>

    <packet family="Game" action="List">
      <comment>Update game score</comment>
      <field name="unk1" type="char"/>
      <field name="unk2" type="short"/>
      <field name="red_score" type="short"/>
      <field name="blue_score" type="short"/>
    </packet>

    <packet family="Game" action="Emote">
      <comment>Shows "come and join" message in status bar</comment>
      <field name="unk" type="short"/>
    </packet>

    <packet family="Game" action="Drop">
      <comment>Plays timer ticking noise</comment>
      <field name="unk" type="char"/> <!-- If 11 it shows "round delayed" message -->
    </packet>

    <packet family="Game" action="Do">
      <comment>Show banner when game is launched</comment>
      <field name="banner_type" type="char"/> <!-- 1 - line up for next match, 11 & 12 & 13 - fight! 21 whack-a-mole -->
      <field name="num_players" type="char"/>
    </packet>

    <packet family="GameBar" action="List">
      <comment>Player leveled up</comment>
      <field name="level" type="short"/>
      <field name="experience" type="five"/>
      <field name="stat_points" type="short"/>
      <field name="skill_points" type="short"/>
      <field name="max_hp" type="three"/>
      <field name="max_tp" type="three"/>
      <field name="max_sp" type="short"/>
      <field name="hp" type="three"/>
      <field name="tp" type="three"/>
      <field name="sp" type="short"/>
      <field name="unk1" type="short"/>
      <field name="unk2" type="short"/>
      <field name="unk3" type="short"/>
      <field name="unk4" type="short"/>
      <field name="unk5" type="short"/>
      <field name="unk6" type="short"/>
      <field name="unk7" type="short"/>
      <field name="secondary_stats" type="CharacterSecondaryStats"/>
    </packet>

    <packet family="GameBar" action="Set">
      <comment>HP/TP update</comment>
      <field name="hp" type="three"/>
      <field name="tp" type="three"/>
      <field type="short">0</field>
    </packet>

    <enum name="ExperienceUpdateType" type="char">
      <value name="Hidden">0</value>
      <value name="Shown">1</value>
      <value name="Quest">2</value>
      <value name="Event">3</value>
      <value name="Game">4</value>
  </enum>

  <packet family="GameBar" action="Time">
      <comment>Experience updated</comment>
      <field name="experience" type="five"/>
      <field name="update_type" type="ExperienceUpdateType"/>
      <field name="boost" type="char"/>
      <field name="reduced_pct" type="char"/>
  </packet>

    <packet family="Gather" action="Get">
      <comment>Nearby gather spots updating</comment>
      <array name="gathers" type="GatherMapInfo"/>
    </packet>

    <packet family="Gather" action="Set">
      <comment>Start gathering</comment>
      <array name="session_id" type="short" length="2"/>
      <field name="gather_index" type="char"/>
    </packet>

    <packet family="Gather" action="Update">
      <comment>Gather spots amount updating</comment>
      <field name="map_id" type="short"/>
      <chunked>
        <array name="gathers" type="GatherMapInfo" delimited="true"/>
      </chunked>
    </packet>

    <packet family="Gather" action="Update2">
      <comment>Gather spot amount updating</comment>
      <field name="gather_index" type="char"/>
      <field name="amount" type="char"/>
      <field name="unk1" type="char"/>
    </packet>

    <packet family="Gather" action="Hit">
      <comment>Other play gathered item before you</comment>
      <field name="unk" type="short"/>
    </packet>

    <packet family="Gather" action="Pickup">
      <comment>Getting item from gather spot</comment>
      <field name="item_id" type="short"/>
      <field name="power" type="char"/>
      <field name="accuracy" type="char"/>
      <field name="dexterity" type="char"/>
      <field name="defense" type="char"/>
      <field name="vitality" type="char"/>
      <field name="aura" type="char"/>
      <field name="sfx_id" type="char"/>
      <field name="weight" type="Weight"/>
      <field name="experience" type="five"/>
    </packet>

    <packet family="Gift" action="Emote">
      <comment>Gift inbox notification</comment>
      <field name="num_items" type="short"/>
    </packet>

    <packet family="Gift" action="Open">
      <comment>Opening gift inbox</comment>
      <length name="num_items" type="short"/>
      <array name="items" length="num_items" type="GiftItem"/>
    </packet>

    <struct name="GiftItem">
      <comment>Item in gift inbox</comment>
      <field name="item_id" type="short"/>
      <field name="power" type="char"/>
      <field name="accuracy" type="char"/>
      <field name="dexterity" type="char"/>
      <field name="defense" type="char"/>
      <field name="vitality" type="char"/>
      <field name="aura" type="char"/>
      <field name="amount" type="three"/>
      <length name="gifter_length" type="char"/>
      <field name="gifter" type="string" length="gifter_length">
        <comment>E for event reward</comment>
      </field>
      <field name="expires_days" type="short"/>
    </struct>

    <packet family="Login" action="Confirm">
        <comment>Successful login result</comment>
            <field name="result_code" type="LoginResult"/>
            <switch field="result_code">
                <case value="Ok">
                  <chunked>
                    <field name="max_skin" type="short"/>
                    <field name="max_hairstyle" type="short"/>
                    <field name="max_name_length" type="char"/>
                    <array name="eif_rid" type="short" length="2"/>
                    <field name="eif_length" type="short"/>
                    <break/>
                    <field name="unk1" type="char"/>
                    <field name="unk2" type="char"/>
                    <break />
                    <array name="characters" type="CharacterSelectionListEntry" delimited="true"/>
                  </chunked>
                </case>
            </switch>
    </packet>

    <packet family="Login" action="Result">
        <comment>Bad login result</comment>
        <chunked>
            <field name="result_code" type="LoginResult"/>
            <switch field="result_code">
                <case value="WrongUser">
                    <field type="string">NO</field>
                </case>
                <case value="WrongUserPassword">
                    <field type="string">NO</field>
                </case>
                <case value="Banned">
                    <field type="string">NO</field>
                </case>
                <case value="LoggedIn">
                    <field type="string">NO</field>
                </case>
                <case value="Busy">
                    <field type="string">NO</field>
                </case>
            </switch>
        </chunked>
    </packet>

    <packet family="Magic" action="Request">
      <comment>Nearby player started casting a spell</comment>
      <field name="player_id" type="short"/>
      <field name="skill_id" type="short"/>
    </packet>

    <packet family="Move" action="Result">
      <comment>Result from player moving</comment>
      <chunked>
        <field name="coords" type="Coords"/>
        <field name="unk" type="char"/>
        <array name="player_ids" type="short"/>
        <break/>
        <array name="npc_indexes" type="short"/>
        <break/>
        <array name="items" type="ItemMapInfo"/>
        <break/>
      </chunked>
    </packet>

    <packet family="Move" action="Set">
      <comment>Nearby player moved</comment>
      <field name="player_id" type="short"/>
      <field name="direction" type="Direction"/>
      <field name="coords" type="Coords"/>
    </packet>

    <packet family="Move" action="Do">
      <comment>Nearby player moved (no walk animation)</comment>
      <field name="player_id" type="short"/>
      <field name="direction" type="Direction"/>
      <field name="coords" type="Coords"/>
    </packet>

    <packet family="Music" action="Open">
      <comment>Reply to opening a jukebox</comment>
      <field name="map_id" type="short"/>
      <field name="requester_name" type="string" optional="true">
        <comment>Name of player who requested current song</comment>
      </field>
    </packet>

    <packet family="Music" action="Result">
      <comment>Reply to unsuccessfully requesting a song</comment>
      <dummy type="short">1</dummy>
    </packet>

    <packet family="Music" action="Set">
      <comment>Play background music</comment>
      <field name="mfx_id" type="char"/>
    </packet>

    <packet family="Music" action="Do">
      <comment>Play jukebox track</comment>
      <field name="track_id" type="short"/>
    </packet>

    <packet family="Music" action="Update">
      <comment>Reply to successfully requesting a song</comment>
      <field name="total_eons" type="int"/>
    </packet>

    <packet family="Music" action="Play">
      <comment>Nearby player playing an instrument</comment>
      <field name="player_id" type="short"/>
      <field name="direction" type="Direction"/>
      <field name="unk" type="char"/>
      <field name="instrument_id" type="char"/>
      <field name="note" type="char"/>
    </packet>

    <struct name="ShopTrade">
      <field name="item_id" type="short"/>
      <field name="sell_price" type="three"/>
      <field name="buy_price" type="three"/>
      <field name="max_amount" type="char"/>
    </struct>

    <struct name="ShopCraftIngredient">
      <field name="item_id" type="short"/>
      <field name="amount" type="three"/>
    </struct>

    <struct name="ShopCraft">
      <field name="item_id" type="short"/>
      <field name="unk1" type="char"/>
      <field name="cost" type="three"/>
      <field name="unk2" type="three"/>
      <field name="unk3" type="short"/>
      <field name="unk4" type="char"/>
      <array name="ingredients" type="ShopCraftIngredient" length="4"/>
    </struct>

    <packet family="Shop" action="Open">
      <comment>Shop opened</comment>
      <chunked>
        <field name="shop_id" type="short"/>
        <field name="unk" type="char"/>
        <field name="name" type="string"/>
        <break/>
        <array name="trades" type="ShopTrade"/>
        <break/>
        <array name="crafts" type="ShopCraft"/>
      </chunked>
    </packet>

    <packet family="Shop" action="Sell">
      <comment>Reply from selling an item</comment>
      <field name="item" type="Item"/>
      <field name="total_eons" type="int"/>
      <field name="weight" type="Weight"/>
    </packet>

    <packet family="Shop" action="Block">
      <comment>Reply from being too low level to use a shop</comment>
      <field name="min_level" type="short"/>
    </packet>

    <packet family="Security" action="Set">
        <comment>Ping request</comment>
        <field name="seq1" type="short" />
        <field name="seq2" type="char" />
    </packet>

    <packet family="Security" action="Confirm">
        <comment>
            Value compared against client value.
            If they don't match a blank popup is spammed every ping (after 30 pings)
        </comment>
        <field name="anti_emulation_validation_server" type="int"/>
    </packet>

    <packet family="System" action="Do">
      <comment>Quest popup box</comment>
      <chunked>
        <field name="title" type="string"/>
        <break/>
        <field name="message" type="string"/>
        <break/>
        <field name="graphic_id" type="short"/>
      </chunked>
    </packet>

    <packet family="Paperdoll" action="Swap">
      <comment>Player changed paperdoll</comment>
      <field name="player_id" type="short"/>
      <field name="unk1" type="char"/>
      <field name="unk2" type="char"/>
      <field name="boots" type="short"/>
      <field name="armor" type="short"/>
      <field name="hat" type="short"/>
      <field name="weapon" type="short"/>
      <field name="shield" type="short"/>
      <field name="buddy_shoulder" type="short"/>
      <field name="buddy_ground" type="short"/>
      <field name="torch" type="short"/>
      <field name="equipped_item" type="ThreeItem"/>
      <field name="unk3" type="char"/>
      <field name="unk4" type="char"/>
      <field name="removed_item" type="ThreeItem"/>
      <field name="hp" type="three"/>
      <field name="max_hp" type="three"/>
      <field name="tp" type="three"/>
      <field name="max_tp" type="three"/>
      <field name="base_stats" type="CharacterBaseStats"/>
      <field name="secondary_secondary" type="CharacterSecondaryStats"/>
      <field name="weight" type="short"/>
    </packet>

    <packet family="Play" action="Confirm">
        <chunked>
            <field name="encryption_modifier1" type="char" />
            <field name="encryption_modifier2" type="char" />
            <field name="unk1" type="three"/>
            <field name="unk2" type="three"/>
            <field name="unk3" type="char"/>
            <field name="unk4" type="char"/>
            <field name="unk5" type="char"/>
            <field name="unk6" type="char"/>
            <field name="unk7" type="char"/>
            <field name="unk8" type="char"/>
            <field name="unk9" type="char"/>
            <field name="unk10" type="char"/>
            <field name="unk11" type="char"/>
            <field name="experience_display_mode" type="ExperienceDisplayMode"/>
            <field name="unk12" type="short"/>
            <field name="unk13" type="char"/>
            <field name="unk14" type="short"/>
            <field name="unk15" type="short"/>
            <field name="unk16" type="char"/>
            <break/>
            <field name="unk17" type="short"/>
            <break/>
            <field name="motd" type="string"/>
            <break/>
            <field name="unk18" type="char"/>
            <field name="equipment" type="EquipmentPlay"/>
            <break/>
            <field name="weight" type="Weight"/>
            <array name="items" type="Item"/>
            <break/>
            <array name="spells" type="Spell"/>
            <break/>
        </chunked>
    </packet>

    <packet family="Play" action="Result">
        <field name="result_code" type="PlayResult"/>
        <switch field="result_code">
          <case value="Ok">
            <chunked>
                <field name="session_id" type="short"/>
                <field name="character_id" type="int"/>
                <field name="map_id" type="short"/>
                <array name="map_rid" type="short" length="2"/>
                <field name="max_file_size" type="three"/>
                <field name="num_map_pubs" type="char"/>
                <array name="map_pub_rid" type="short" length="2"/>
                <field name="num_maps" type="short"/>
                <field name="num_item_pubs" type="char"/>
                <array name="item_pub_rid" type="short" length="2"/>
                <field name="num_items" type="short"/>
                <field name="num_npc_pubs" type="char"/>
                <array name="npc_pub_rid" type="short" length="2"/>
                <field name="num_npcs" type="short"/>
                <field name="num_skill_pubs" type="char"/>
                <array name="skill_pub_rid" type="short" length="2"/>
                <field name="num_skills" type="short"/>
                <field name="num_class_pubs" type="char"/>
                <array name="class_pub_rid" type="short" length="2"/>
                <field name="num_classes" type="short"/>
                <field name="num_quest_pubs" type="char"/>
                <array name="quest_pub_rid" type="short" length="2"/>
                <field name="num_quests" type="short"/>
                <field name="ip" type="string"/>
                <break/>
                <field name="name" type="string"/>
                <break/>
                <field name="title" type="string"/>
                <break/>
                <field name="class_id" type="char"/>
                <field name="guild_tag" type="string" length="3"/>
                <field name="admin_level" type="AdminLevel"/>
                <field name="level" type="short"/>
                <field name="experience" type="five"/>
                <field name="tnl" type="int"/>
                <field name="stats" type="CharacterStatsPlay"/>
                <field name="unk1" type="short"/>
                <field name="unk2" type="short"/>
                <field name="unk3" type="char"/>
                <field name="unk4" type="char"/>
                <field name="unk5" type="char"/>
                <field name="unk6" type="char"/>
                <field name="unk7" type="char"/>
                <field name="unk8" type="char"/>
                <field name="unk9" type="char"/>
                <field name="unk10" type="char"/>
                <field name="unk11" type="char"/>
                <field name="unk12" type="char"/>
                <field name="unk13" type="char"/>
                <field name="unk14" type="char"/>
                <field name="unk15" type="char"/>
                <field name="unk16" type="char"/>
                <field name="jail_map" type="short"/>
                <field name="rescue_map" type="short"/>
                <field name="rescue_coords" type="Coords"/>
                <field name="unk17" type="short"/>
                <field name="show_welcome_message" type="bool"/>
                <break />
            </chunked>
          </case>
        </switch>
    </packet>

    <packet family="Play" action="Update">
      <chunked>
        <array name="news" type="string" length="8" delimited="true"/>
      </chunked>
    </packet>

    <packet family="Player" action="Update">
      <comment>Player has appeared in nearby view</comment>
      <chunked>
        <array name="characters" type="CharacterMapInfo" delimited="true"/>
      </chunked>
    </packet>

    <packet family="Player" action="Delete">
      <comment>Nearby player logged out</comment>
      <field name="player_id" type="short"/>
    </packet>

    <packet family="Players" action="Delete">
      <comment>Player removed from nearby view</comment>
      <field name="player_id" type="short"/>
      <field name="warp_animation" type="WarpAnimation"/>
    </packet>

    <packet family="Players" action="Spawn">
      <comment>Nearby player transformed into an npc</comment>
      <field name="player_id" type="short"/>
      <field name="npc_id" type="short"/>
    </packet>

    <packet family="Chat" action="Set">
      <comment>A local chat message</comment>
      <field name="player_id" type="short"/>
      <field name="message" type="string"/>
    </packet>

    <packet family="Chat" action="Private">
      <comment>A private message</comment>
      <chunked>
        <field name="name" type="string"/>
        <break/>
        <field name="message" type="string"/>
      </chunked>
    </packet>

    <packet family="Chat" action="Admin">
      <comment>An admin group message</comment>
      <chunked>
        <field name="name" type="string"/>
        <break/>
        <field name="message" type="string"/>
      </chunked>
    </packet>

    <packet family="Chat" action="Global">
      <comment>An admin announcement</comment>
      <chunked>
        <field name="name" type="string"/>
        <break/>
        <field name="message" type="string"/>
      </chunked>
    </packet>

    <packet family="Chat" action="Request">
      <comment>A guild message</comment>
      <chunked>
        <field name="name" type="string"/>
        <break/>
        <field name="message" type="string"/>
      </chunked>
    </packet>

    <packet family="Chat" action="Play">
      <comment>A global chat message</comment>
      <chunked>
        <field name="name" type="string"/>
        <break/>
        <field name="message" type="string"/>
      </chunked>
    </packet>

    <packet family="Chat" action="Update">
      <comment>Adds message to system tab</comment>
      <field name="message" type="string"/>
    </packet>

    <packet family="Chat" action="Ping">
      <comment>Silently adds message to system tab</comment>
      <field name="message" type="string"/>
    </packet>

    <packet family="Chat" action="System">
      <comment>Adds message to system tab</comment>
      <field name="message" type="string"/>
    </packet>

    <packet family="Chat" action="Spawn">
      <comment>Server message</comment>
      <field name="message" type="string"/>
    </packet>

    <packet family="Chat" action="Block">
      <comment>Player muted</comment>
      <field name="admin_name" type="string"/>
    </packet>

    <packet family="Chat" action="New">
      <comment>Player un-muted</comment>
      <dummy type="byte">255</dummy>
    </packet>

    <packet family="Chat" action="Junk">
      <comment>Clears all GLB messages from name</comment>
      <field name="name" type="string"/>
    </packet>

    <packet family="Chat" action="Drop">
      <comment>Remove messages from GLB</comment>
      <field name="message_count" type="short"/>
      <field name="show_friendly_reminder" type="bool"/>
    </packet>

    <packet family="Chat" action="Result">
      <comment>Reply to trying to send a private message</comment>
      <field name="result_code" type="ChatResult"/>
      <switch field="result_code">
        <case value="NotFound">
          <field name="name" type="string"/>
        </case>
      </switch>
    </packet>

    <packet family="Chat" action="List">
      <comment>Global chat backfill</comment>
      <chunked>
        <array name="messages" type="GlobalBackfillMessage" delimited="true"/>
      </chunked>
    </packet>

    <packet family="Chat" action="Syn4">
      <comment>Banner message</comment>
      <field name="type" type="BannerType"/>
      <field name="banner_display_duration" type="short">
        <comment>Number of seconds the banner is shown. The client expects a value of 2 or higher</comment>
      </field>
      <field name="permanent" type="bool">
        <comment>If true the banner will show until a new banner is shown or the player logs out</comment>
      </field>
      <field name="unk" type="char"/>
      <field name="message" type="string"/>
    </packet>

    <packet family="Chest" action="Open">
        <comment>Reply to opening a chest</comment>
        <field name="coords" type="Coords"/>
        <array name="items" type="ThreeItem"/>
    </packet>

    <packet family="Chest" action="Result">
        <comment>Reply to placing an item in to a chest</comment>
        <field name="added_item_id" type="short"/>
        <field name="remaining_amount" type="int"/>
        <field name="weight" type="Weight"/>
        <array name="items" type="ThreeItem"/>
    </packet>

    <packet family="Chest" action="Pickup">
        <comment>Reply to removing an item from a chest</comment>
        <field name="taken_item" type="ThreeItem"/>
        <field name="weight" type="Weight"/>
        <array name="items" type="ThreeItem"/>
    </packet>

    <packet family="Emote" action="Set">
      <comment>Nearby player emoting</comment>
      <field name="player_id" type="short"/>
      <field name="emote" type="Emote"/>
    </packet>

    <packet family="Npc" action="Update">
      <comment>NPCs appearing in nearby view</comment>
      <chunked>
        <array name="npcs" type="NpcMapInfo" delimited="true"/>
      </chunked>
    </packet>

    <packet family="Npc" action="Set">
      <comment>Main NPC update messages</comment>
      <chunked>
        <array name="positions" type="NpcUpdatePosition"/>
        <break/>
        <array name="attacks" type="NpcUpdateAttack"/>
        <break/>
        <array name="chats" type="NpcUpdateChat"/>
        <break/>
      </chunked>
    </packet>

    <packet family="Npc" action="Spawn">
      <comment>NPCs spawning in nearby view</comment>
      <field name="npc" type="NpcMapInfo"/>
    </packet>

    <enum name="NpcEmote" type="char">
      <comment>Emote type for NPCs</comment>
      <value name="Alert">1</value>
      <value name="Reserved2">2</value>
      <value name="Heart">3</value>
    </enum>

    <packet family="Npc" action="Delete">
      <comment>Remove NPCs from nearby view</comment>
      <array name="npc_indexes" type="short"/>
    </packet>

    <packet family="Npc" action="Swap">
      <comment>NPC changing facing direction</comment>
      <field name="npc_index" type="short"/>
      <field name="direction" type="Direction"/>
    </packet>

    <packet family="Npc" action="View">
      <comment>NPC chat message</comment>
      <field name="npc_index" type="short"/>
      <length name="message_length" type="char"/>
      <field name="message" type="string" length="message_length"/>
    </packet>

    <packet family="Npc" action="Junk">
        <comment>Clearing all boss children</comment>
        <field name="npc_id" type="short"/>
    </packet>

    <packet family="Npc" action="Emote">
      <comment>NPC Emoting</comment>
      <field name="npc_index" type="short"/>
      <field name="emote" type="NpcEmote"/>
      <field name="unk1" type="char" optional="true"/>
      <field name="unk2" type="char" optional="true"/>
      <field name="sfx_id" type="char" optional="true">
        <comment>Only plays if unk1 and unk2 are set too</comment>
      </field>
    </packet>

    <packet family="Npc" action="Pickup">
      <comment>Reply to picking up an npc</comment>
      <field name="npc_index" type="short"/>
      <field name="coords" type="Coords"/>
      <field name="sfx_id" type="char"/>
    </packet>

    <packet family="Range" action="Result">
      <comment>Nearby players or npcs appearing</comment>
      <field name="nearby" type="NearbyInfo"/>
    </packet>

    <packet family="Refresh" action="Result">
      <field name="nearby" type="NearbyInfo"/>
    </packet>

    <packet family="Refresh" action="Delete">
      <comment>Clear nearby info</comment>
      <dummy type="char">0</dummy>
    </packet>

    <packet family="Rest" action="Delete">
        <comment>Nearby player standing up</comment>
        <field name="player_id" type="short"/>
        <field name="coords" type="Coords"/>
    </packet>

    <packet family="Rest" action="Close">
      <comment>Player standing</comment>
      <field name="player_id" type="short"/>
      <field name="coords" type="Coords"/>
    </packet>

    <packet family="Rest" action="Result">
      <comment>Player sitting</comment>
      <field name="player_id" type="short"/>
      <field name="coords" type="Coords"/>
      <field name="direction" type="Direction"/>
      <!-- Sent by the official server and ignored by the official client -->
      <field type="char">0</field>
    </packet>

    <packet family="Rest" action="Set">
      <comment>Nearby player sitting</comment>
      <field name="player_id" type="short"/>
      <field name="coords" type="Coords"/>
      <field name="direction" type="Direction"/>
      <!-- Sent by the official server and ignored by the official client -->
      <field type="char">0</field>
    </packet>

    <packet family="Sit" action="Close">
      <comment>Player standing from a chair</comment>
      <field name="player_id" type="short"/>
      <field name="coords" type="Coords"/>
    </packet>

    <packet family="Sit" action="Delete">
      <comment>Nearby player standing from a chair</comment>
      <field name="player_id" type="short"/>
      <field name="coords" type="Coords"/>
    </packet>

    <packet family="Sit" action="Result">
      <comment>Player sitting in a chair</comment>
      <field name="player_id" type="short"/>
      <field name="coords" type="Coords"/>
      <field name="direction" type="Direction"/>
      <!-- Sent by the official server and ignored by the official client -->
      <field type="char">0</field>
    </packet>

    <packet family="Sit" action="Set">
      <comment>Nearby player sitting in a chair</comment>
      <field name="player_id" type="short"/>
      <field name="coords" type="Coords"/>
      <field name="direction" type="Direction"/>
      <!-- Sent by the official server and ignored by the official client -->
      <field type="char">0</field>
    </packet>

    <packet family="Attack" action="Set">
      <comment>Nearby player attacked</comment>
      <field name="player_id" type="short"/>
      <field name="direction" type="Direction"/>
      <field name="unk" type="char"/>
    </packet>

    <packet family="Direction" action="Set">
      <comment>Nearby player changed direction</comment>
      <field name="player_id" type="short"/>
      <field name="direction" type="Direction"/>
    </packet>

    <packet family="Fishing" action="Hit">
      <comment>Fishing update</comment>
      <field name="unk1" type="char"/>
      <field name="unk2" type="char"/>
      <field name="unk3" type="char"/>
    </packet>

    <packet family="Fishing" action="Take">
      <comment>Nearby player caught a fish</comment>
      <field name="player_id" type="short"/>
      <field name="item_id" type="short"/>
      <field name="y_offset" type="char"/>
    </packet>

    <packet family="Fishing" action="Result">
      <comment>Fishing result</comment>
      <field name="item" type="ThreeItem"/>
      <field name="current_weight" type="short"/>
      <field name="y_offset" type="char"/>
    </packet>

    <packet family="Fishing" action="Open">
      <comment>Player started fishing</comment>
      <field name="player_id" type="short"/>
      <field name="coords" type="Coords"/>
      <field name="direction" type="Direction"/>
      <field name="unk" type="char"/>
    </packet>

    <packet family="Fishing" action="Set">
      <comment>Nearby player started fishing</comment>
      <field name="player_id" type="short"/>
      <field name="coords" type="Coords"/>
      <field name="direction" type="Direction"/>
      <field name="unk" type="char"/>
    </packet>

    <packet family="Fishing" action="Update2">
      <comment>Nearby player random bobber movement</comment>
      <field name="player_id" type="short"/>
    </packet>

    <packet family="Fishing" action="Close">
      <comment>Nearby player stopped fishing</comment>
      <field name="player_id" type="short"/>
    </packet>

    <packet family="Fishing" action="Junk">
      <comment>Reply to trying to fish overweight</comment>
      <field name="player_id" type="short"/>
      <field name="weight" type="Weight"/>
    </packet>

    <packet family="Attack" action="Drop">
      <comment>Nearby NPC killed by player and item dropped</comment>
      <field name="killer_direction" type="Direction"/>
      <field name="killer_player_id" type="short"/>
      <field name="npc_index" type="short"/>
      <field name="unk1" type="short"/>
      <field name="damage" type="int"/>
      <field name="unk2" type="char"/>
      <field name="drop_id" type="short"/>
      <field name="power" type="char"/>
      <field name="accuracy" type="char"/>
      <field name="dexterity" type="char"/>
      <field name="defense" type="char"/>
      <field name="vitality" type="char"/>
      <field name="aura" type="char"/>
      <field name="amount" type="int"/>
      <field name="drop_index" type="short"/>
      <field name="coords" type="Coords"/>
    </packet>

    <packet family="Attack" action="Close">
      <comment>Nearby NPC killed by player</comment>
      <field name="killer_direction" type="Direction"/>
      <field name="killer_player_id" type="short"/>
      <field name="npc_index" type="short"/>
      <field name="unk1" type="short"/>
      <field name="damage" type="int"/>
      <field name="unk2" type="char"/>
    </packet>

    <packet family="Attack" action="Hit">
      <comment>Nearby NPC hit by player</comment>
      <field name="attacker_direction" type="Direction"/>
      <field name="attacker_player_id" type="short"/>
      <field name="npc_index" type="short"/>
      <field name="hp_percentage" type="char"/>
      <field name="damage" type="int"/>
      <field name="unk" type="char"/>
    </packet>

    <packet family="Map" action="Confirm">
      <comment>Requesting player to warp to another map</comment>
      <field name="warp_type" type="WarpType"/>
      <field name="map_id" type="short"/>
      <switch field="warp_type">
          <case value="Switch">
              <array name="map_rid" type="short" length="2"/>
              <field name="map_file_size" type="three"/>
          </case>
      </switch>
      <field name="session_id" type="short"/>
    </packet>

    <packet family="Map" action="Update2">
      <comment>Entering a new map</comment>
      <field name="warp_type" type="WarpType"/>
      <field name="map_id" type="short"/>
      <field name="channel" type="char"/>
      <field name="unk1" type="char"/>
      <field name="unk2" type="char"/>
      <field name="unk3" type="char"/>
      <field name="unk4" type="char"/>
      <field name="unk5" type="char"/>
      <field name="unk6" type="char"/>
      <field name="warp_animation" type="WarpAnimation"/>
    </packet>

    <packet family="System" action="Syn3">
      <comment>System pong response</comment>
      <dummy type="char">3</dummy>
    </packet>

    <packet family="Door" action="Open">
        <comment>Nearby door opening</comment>
        <field name="coords" type="Coords"/>
        <field type="char">0</field>
    </packet>

    <packet family="Map" action="Time">
        <comment>Time of day change</comment>
        <field name="change_type" type="MapTimeChangeType"/>
        <switch field="change_type">
            <case value="DayMode">
                <field name="daymode" type="char"/>
            </case>
            <case value="LightAdjustment">
                <field name="background_light" type="char"/>
                <field name="ambient_light" type="char"/>
                <field name="player_light" type="char"/>
            </case>
        </switch>
    </packet>
</protocol>
